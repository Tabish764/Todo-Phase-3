# API Contract: Todo AI Chatbot - Conversation Management

## Overview
This document defines the API contracts for managing conversations and messages in the Todo AI Chatbot system.

## Base URL
```
http://localhost:8000/api/v1
```

## Authentication
All endpoints require authentication via Better Auth tokens in the Authorization header:
```
Authorization: Bearer {token}
```

## Endpoints

### POST /conversations
Create a new conversation for the authenticated user.

#### Request
```json
{
  "title": "Optional conversation title"
}
```

#### Response 201 Created
```json
{
  "id": 123,
  "user_id": "user123",
  "title": "Optional conversation title",
  "created_at": "2025-12-26T10:00:00Z",
  "updated_at": "2025-12-26T10:00:00Z"
}
```

#### Error Responses
- 401: Unauthorized - Invalid or missing authentication token
- 422: Unprocessable Entity - Invalid request body

### GET /conversations
Get all conversations for the authenticated user, sorted by most recent activity.

#### Query Parameters
- `limit` (optional): Number of conversations to return (default: 20, max: 100)
- `offset` (optional): Number of conversations to skip (default: 0)

#### Response 200 OK
```json
{
  "conversations": [
    {
      "id": 123,
      "user_id": "user123",
      "title": "Todo planning session",
      "created_at": "2025-12-26T09:00:00Z",
      "updated_at": "2025-12-26T10:00:00Z"
    },
    {
      "id": 122,
      "user_id": "user123",
      "title": "Grocery list help",
      "created_at": "2025-12-25T15:30:00Z",
      "updated_at": "2025-12-25T16:45:00Z"
    }
  ],
  "total": 15,
  "limit": 20,
  "offset": 0
}
```

#### Error Responses
- 401: Unauthorized - Invalid or missing authentication token

### GET /conversations/{id}
Get details of a specific conversation.

#### Path Parameters
- `id`: Conversation ID

#### Response 200 OK
```json
{
  "id": 123,
  "user_id": "user123",
  "title": "Todo planning session",
  "created_at": "2025-12-26T09:00:00Z",
  "updated_at": "2025-12-26T10:00:00Z"
}
```

#### Error Responses
- 401: Unauthorized - Invalid or missing authentication token
- 404: Not Found - Conversation doesn't exist or doesn't belong to user

### POST /conversations/{id}/messages
Add a message to an existing conversation.

#### Path Parameters
- `id`: Conversation ID

#### Request
```json
{
  "role": "user",
  "content": "I need help organizing my tasks",
  "tool_calls": {
    "function": "get_user_todos",
    "arguments": {}
  }
}
```

#### Response 201 Created
```json
{
  "id": 456,
  "conversation_id": 123,
  "user_id": "user123",
  "role": "user",
  "content": "I need help organizing my tasks",
  "tool_calls": {
    "function": "get_user_todos",
    "arguments": {}
  },
  "created_at": "2025-12-26T10:05:00Z"
}
```

#### Error Responses
- 401: Unauthorized - Invalid or missing authentication token
- 404: Not Found - Conversation doesn't exist or doesn't belong to user
- 422: Unprocessable Entity - Invalid request body

### GET /conversations/{id}/messages
Get all messages in a specific conversation, sorted chronologically.

#### Path Parameters
- `id`: Conversation ID

#### Query Parameters
- `limit` (optional): Number of messages to return (default: 50, max: 200)
- `offset` (optional): Number of messages to skip (default: 0)

#### Response 200 OK
```json
{
  "messages": [
    {
      "id": 456,
      "conversation_id": 123,
      "user_id": "user123",
      "role": "user",
      "content": "I need help organizing my tasks",
      "tool_calls": null,
      "created_at": "2025-12-26T10:05:00Z"
    },
    {
      "id": 457,
      "conversation_id": 123,
      "user_id": "user123",
      "role": "assistant",
      "content": "I'd be happy to help. Could you share your current tasks?",
      "tool_calls": null,
      "created_at": "2025-12-26T10:06:00Z"
    }
  ],
  "total": 2,
  "limit": 50,
  "offset": 0
}
```

#### Error Responses
- 401: Unauthorized - Invalid or missing authentication token
- 404: Not Found - Conversation doesn't exist or doesn't belong to user

## Data Models

### Conversation
| Field | Type | Required | Description |
|-------|------|----------|-------------|
| id | integer | Yes | Unique identifier |
| user_id | string | Yes | ID of the user who owns the conversation |
| title | string | No | Optional title for the conversation |
| created_at | string (date-time) | Yes | When the conversation was created |
| updated_at | string (date-time) | Yes | When the conversation was last updated |

### Message
| Field | Type | Required | Description |
|-------|------|----------|-------------|
| id | integer | Yes | Unique identifier |
| conversation_id | integer | Yes | ID of the parent conversation |
| user_id | string | Yes | ID of the user who sent the message |
| role | string | Yes | One of: 'user', 'assistant', 'system' |
| content | string | Yes | The message content |
| tool_calls | object | No | JSON object containing tool call information |
| created_at | string (date-time) | Yes | When the message was created |

## Error Format
All error responses follow this format:
```json
{
  "detail": "Error message describing the issue"
}
```